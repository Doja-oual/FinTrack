<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - FinSolutions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-pink-50 via-purple-50 to-rose-50 min-h-screen">
    <!-- Navbar -->
    <nav class="bg-white/80 backdrop-blur-md shadow-lg border-b border-pink-100">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-r from-pink-400 to-purple-400 rounded-full p-2">
                        <i class="fas fa-heart text-white text-xl"></i>
                    </div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-pink-500 to-purple-500 bg-clip-text text-transparent">
                        FinSolutions
                    </h1>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="/transactions" class="text-gray-600 hover:text-pink-500 transition flex items-center space-x-2">
                        <i class="fas fa-exchange-alt"></i>
                        <span class="hidden md:inline">Transactions</span>
                    </a>
                    <a href="/budgets" class="text-gray-600 hover:text-purple-500 transition flex items-center space-x-2">
                        <i class="fas fa-chart-pie"></i>
                        <span class="hidden md:inline">Budgets</span>
                    </a>
                    <a href="/categories" class="text-gray-600 hover:text-rose-500 transition flex items-center space-x-2">
                        <i class="fas fa-tags"></i>
                        <span class="hidden md:inline">Catégories</span>
                    </a>
                    <a href="/logout" class="bg-gradient-to-r from-pink-400 to-rose-400 text-white px-5 py-2 rounded-full hover:from-pink-500 hover:to-rose-500 transition shadow-md">
                        <i class="fas fa-sign-out-alt mr-2"></i>
                        <span class="hidden md:inline">Déconnexion</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Contenu Principal -->
    <div class="container mx-auto px-6 py-8">
        <!-- Section Bienvenue -->
        <div class="mb-8 relative">
            <div class="absolute -top-4 -left-4 text-pink-200 text-6xl opacity-20">
                <i class="fas fa-heart"></i>
            </div>
            <div class="relative">
                <h2 class="text-4xl font-bold text-gray-800 mb-2">Bonjour <%= user.firstName %> !</h2>
                <p class="text-gray-600">Voici un aperçu de vos finances aujourd'hui</p>
            </div>
        </div>

        <!-- Cartes de statistiques -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Solde Total -->
            <div class="bg-white rounded-3xl shadow-xl p-6 border-2 border-pink-100 hover:shadow-2xl transition transform hover:-translate-y-1">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-gradient-to-br from-pink-400 to-rose-400 rounded-2xl p-4 shadow-lg">
                        <i class="fas fa-wallet text-white text-2xl"></i>
                    </div>
                </div>
                <p class="text-gray-500 text-sm font-medium mb-1">Solde Total</p>
                <p class="text-3xl font-bold bg-gradient-to-r from-pink-500 to-rose-500 bg-clip-text text-transparent">
                    <%= balance ? balance.toFixed(2) : '0.00' %> MAD
                </p>
                <div class="mt-3 flex items-center text-sm <%= balance >= 0 ? 'text-green-500' : 'text-red-500' %>">
                    <i class="fas <%= balance >= 0 ? 'fa-arrow-up' : 'fa-arrow-down' %> mr-1"></i>
                    <span><%= balance >= 0 ? 'Positif' : 'Négatif' %></span>
                </div>
            </div>

            <!-- Revenus -->
            <div class="bg-white rounded-3xl shadow-xl p-6 border-2 border-purple-100 hover:shadow-2xl transition transform hover:-translate-y-1">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-gradient-to-br from-purple-400 to-indigo-400 rounded-2xl p-4 shadow-lg">
                        <i class="fas fa-arrow-trend-up text-white text-2xl"></i>
                    </div>
                </div>
                <p class="text-gray-500 text-sm font-medium mb-1">Revenus ce mois</p>
                <p class="text-3xl font-bold bg-gradient-to-r from-purple-500 to-indigo-500 bg-clip-text text-transparent">
                    <%= totalIncome ? totalIncome.toFixed(2) : '0.00' %> MAD
                </p>
                <div class="mt-3 flex items-center text-sm text-purple-500">
                    <i class="fas fa-sparkles mr-1"></i>
                    <span><%= incomeCount || 0 %> transaction(s)</span>
                </div>
            </div>

            <!-- Dépenses -->
            <div class="bg-white rounded-3xl shadow-xl p-6 border-2 border-rose-100 hover:shadow-2xl transition transform hover:-translate-y-1">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-gradient-to-br from-rose-400 to-pink-400 rounded-2xl p-4 shadow-lg">
                        <i class="fas fa-shopping-bag text-white text-2xl"></i>
                    </div>
                </div>
                <p class="text-gray-500 text-sm font-medium mb-1">Dépenses ce mois</p>
                <p class="text-3xl font-bold bg-gradient-to-r from-rose-500 to-pink-500 bg-clip-text text-transparent">
                    <%= totalExpense ? totalExpense.toFixed(2) : '0.00' %> MAD
                </p>
                <div class="mt-3 flex items-center text-sm text-gray-500">
                    <i class="fas fa-shopping-cart mr-1"></i>
                    <span><%= expenseCount || 0 %> transaction(s)</span>
                </div>
            </div>

            <!-- Budgets -->
            <div class="bg-white rounded-3xl shadow-xl p-6 border-2 border-amber-100 hover:shadow-2xl transition transform hover:-translate-y-1">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-gradient-to-br from-amber-400 to-yellow-400 rounded-2xl p-4 shadow-lg">
                        <i class="fas fa-chart-pie text-white text-2xl"></i>
                    </div>
                </div>
                <p class="text-gray-500 text-sm font-medium mb-1">Budgets Actifs</p>
                <p class="text-3xl font-bold bg-gradient-to-r from-amber-500 to-yellow-500 bg-clip-text text-transparent">
                    <%= budgetCount || 0 %>
                </p>
                <div class="mt-3 flex items-center text-sm text-amber-500">
                    <i class="fas fa-star mr-1"></i>
                    <span>Ce mois-ci</span>
                </div>
            </div>
        </div>


        <!-- Ajoutez cette section APRÈS la grille de statistiques et AVANT les Actions Rapides -->

<!-- Section Profil Utilisateur -->
<div class="mb-8">
    <div class="bg-white/80 backdrop-blur rounded-3xl shadow-xl p-8 border-2 border-pink-100">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                <i class="fas fa-user-circle text-pink-400 mr-3"></i>
                Mon Profil
            </h3>
            <a href="/profile/edit" class="text-pink-500 hover:text-pink-600 text-sm font-medium">
                Modifier →
            </a>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Informations personnelles -->
            <div class="space-y-4">
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-400 rounded-full flex items-center justify-center text-white text-2xl font-bold shadow-lg">
                        <%= user.firstName.charAt(0).toUpperCase() %><%= user.lastName ? user.lastName.charAt(0).toUpperCase() : '' %>
                    </div>
                    <div>
                        <h4 class="text-xl font-bold text-gray-800">
                            <%= user.firstName %> <%= user.lastName || '' %>
                        </h4>
                        <p class="text-gray-500 text-sm">
                            <i class="fas fa-envelope mr-1"></i>
                            <%= user.email %>
                        </p>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-xl p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-600 text-sm">
                            <i class="fas fa-coins mr-2 text-amber-500"></i>
                            Devise
                        </span>
                        <span class="font-semibold text-gray-800"><%= user.currency || 'MAD' %></span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600 text-sm">
                            <i class="fas fa-calendar-check mr-2 text-green-500"></i>
                            Membre depuis
                        </span>
                        <span class="font-semibold text-gray-800">
                            <%= new Date(user.createdAt).toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' }) %>
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Actions rapides du profil -->
            <div class="space-y-3">
                <a href="/profile/edit" class="flex items-center justify-between p-4 bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl hover:shadow-md transition group">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-pink-400 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition">
                            <i class="fas fa-user-edit text-white"></i>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800">Modifier mes informations</p>
                            <p class="text-xs text-gray-500">Nom, email, devise</p>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right text-pink-400"></i>
                </a>
                
                <a href="/profile/change-password" class="flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl hover:shadow-md transition group">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-purple-400 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition">
                            <i class="fas fa-lock text-white"></i>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800">Changer le mot de passe</p>
                            <p class="text-xs text-gray-500">Sécurité du compte</p>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right text-purple-400"></i>
                </a>
                
                <a href="/profile/settings" class="flex items-center justify-between p-4 bg-gradient-to-r from-amber-50 to-yellow-50 rounded-xl hover:shadow-md transition group">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-amber-400 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition">
                            <i class="fas fa-cog text-white"></i>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800">Paramètres</p>
                            <p class="text-xs text-gray-500">Préférences et notifications</p>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right text-amber-400"></i>
                </a>
            </div>
        </div>
    </div>
</div>
        <!-- Actions Rapides -->
        <div class="mb-8">
            <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-magic text-pink-400 mr-3"></i>
                Actions Rapides
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <a href="/transactions/create" class="group bg-gradient-to-br from-pink-400 to-rose-400 rounded-3xl shadow-xl p-8 hover:shadow-2xl transition transform hover:-translate-y-2 text-white">
                    <div class="flex flex-col items-center text-center">
                        <div class="bg-white/20 backdrop-blur rounded-full p-6 mb-4 group-hover:scale-110 transition">
                            <i class="fas fa-plus text-4xl"></i>
                        </div>
                        <h4 class="font-bold text-xl mb-2">Nouvelle Transaction</h4>
                        <p class="text-pink-100 text-sm">Ajouter un revenu ou une dépense</p>
                    </div>
                </a>

                <a href="/budgets/create" class="group bg-gradient-to-br from-purple-400 to-indigo-400 rounded-3xl shadow-xl p-8 hover:shadow-2xl transition transform hover:-translate-y-2 text-white">
                    <div class="flex flex-col items-center text-center">
                        <div class="bg-white/20 backdrop-blur rounded-full p-6 mb-4 group-hover:scale-110 transition">
                            <i class="fas fa-chart-pie text-4xl"></i>
                        </div>
                        <h4 class="font-bold text-xl mb-2">Créer un Budget</h4>
                        <p class="text-purple-100 text-sm">Planifier vos dépenses mensuelles</p>
                    </div>
                </a>

                <a href="/categories/create" class="group bg-gradient-to-br from-amber-400 to-yellow-400 rounded-3xl shadow-xl p-8 hover:shadow-2xl transition transform hover:-translate-y-2 text-white">
                    <div class="flex flex-col items-center text-center">
                        <div class="bg-white/20 backdrop-blur rounded-full p-6 mb-4 group-hover:scale-110 transition">
                            <i class="fas fa-tags text-4xl"></i>
                        </div>
                        <h4 class="font-bold text-xl mb-2">Nouvelle Catégorie</h4>
                        <p class="text-amber-100 text-sm">Organiser vos transactions</p>
                    </div>
                </a>
            </div>
        </div>

        <!-- Section Transactions et Budgets -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Transactions récentes -->
            <div class="bg-white/80 backdrop-blur rounded-3xl shadow-xl p-8 border-2 border-pink-100">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-clock-rotate-left text-pink-400 mr-3"></i>
                        Transactions Récentes
                    </h3>
                    <a href="/transactions" class="text-pink-500 hover:text-pink-600 text-sm font-medium">
                        Voir tout →
                    </a>
                </div>
                <div class="space-y-4">
                    <% if (recentTransactions && recentTransactions.length > 0) { %>
                        <% recentTransactions.slice(0, 5).forEach(transaction => { %>
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center mr-3 <%= transaction.type === 'income' ? 'bg-green-100' : 'bg-red-100' %>">
                                        <i class="fas <%= transaction.type === 'income' ? 'fa-arrow-up text-green-600' : 'fa-arrow-down text-red-600' %>"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-800"><%= transaction.description || 'Sans description' %></p>
                                        <p class="text-xs text-gray-500"><%= new Date(transaction.date).toLocaleDateString('fr-FR') %></p>
                                    </div>
                                </div>
                                <span class="font-bold <%= transaction.type === 'income' ? 'text-green-600' : 'text-red-600' %>">
                                    <%= transaction.type === 'income' ? '+' : '-' %><%= parseFloat(transaction.amount).toFixed(2) %> MAD
                                </span>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div class="text-center py-12">
                            <div class="inline-block bg-pink-100 rounded-full p-6 mb-4">
                                <i class="fas fa-receipt text-pink-400 text-4xl"></i>
                            </div>
                            <p class="text-gray-500 mb-3">Aucune transaction pour le moment</p>
                            <a href="/transactions/create" class="inline-block bg-gradient-to-r from-pink-400 to-rose-400 text-white px-6 py-3 rounded-full hover:shadow-lg transition">
                                <i class="fas fa-plus mr-2"></i>
                                Ajouter une transaction
                            </a>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Budgets actifs -->
            <div class="bg-white/80 backdrop-blur rounded-3xl shadow-xl p-8 border-2 border-purple-100">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-chart-pie text-purple-400 mr-3"></i>
                        Mes Budgets
                    </h3>
                    <a href="/budgets" class="text-purple-500 hover:text-purple-600 text-sm font-medium">
                        Voir tout →
                    </a>
                </div>
                <div class="space-y-4">
                    <% if (recentBudgets && recentBudgets.length > 0) { %>
                        <% recentBudgets.slice(0, 3).forEach(budget => { %>
                            <div class="p-4 bg-gray-50 rounded-xl">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="font-semibold text-gray-800"><%= budget.category.name %></span>
                                    <span class="text-sm text-gray-600"><%= budget.percentage.toFixed(0) %>%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                    <div class="h-full rounded-full <%= budget.isOverBudget ? 'bg-red-500' : budget.isNearLimit ? 'bg-orange-500' : 'bg-green-500' %>" 
                                         style="width: <%= Math.min(100, budget.percentage) %>%">
                                    </div>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div class="text-center py-12">
                            <div class="inline-block bg-purple-100 rounded-full p-6 mb-4">
                                <i class="fas fa-chart-pie text-purple-400 text-4xl"></i>
                            </div>
                            <p class="text-gray-500 mb-3">Aucun budget défini</p>
                            <a href="/budgets/create" class="inline-block bg-gradient-to-r from-purple-400 to-indigo-400 text-white px-6 py-3 rounded-full hover:shadow-lg transition">
                                <i class="fas fa-plus mr-2"></i>
                                Créer un budget
                            </a>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- Citation motivante -->
        <div class="mt-8 bg-gradient-to-r from-pink-400 via-rose-400 to-purple-400 rounded-3xl shadow-xl p-8 text-white text-center">
            <i class="fas fa-quote-left text-3xl mb-4 opacity-50"></i>
            <p class="text-xl font-medium mb-2">Un budget n'est pas une limite, c'est un plan vers vos rêves</p>
            <p class="text-pink-100 text-sm">Continuez à gérer vos finances avec sagesse</p>
        </div>
    </div>
</body>
</html>